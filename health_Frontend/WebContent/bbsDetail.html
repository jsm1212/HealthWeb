<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ë‚˜í™€ë¡œGYMì— ê²Œì‹œê¸€</title>
<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link rel="shortcut icon" type="imageâ„x-icon" href="https://firebasestorage.googleapis.com/v0/b/healthapp-client.appspot.com/o/images%2Fhome.png?alt=media&token=c30ebcc4-6ca5-4745-a01e-ecaf8e97d972">
<link href="css/bbsDetail.css?ver=4" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<style type="text/css">
body {
  line-height: 1;
  background-color:#f5f5f5;
}
</style>

</head>
<body>
<header class="blog-header py-3">
<div id="spaceBetween">
	<div style="padding-left:2%;">
		<h3 align="left" style="display:inline;">ììœ ê²Œì‹œíŒ</h3>
	</div>
	
	<div align="right" style="display:inline; margin-right:30px;">
		<span id="userNickname"></span>
		<button type="button" class="btn btn-sm btn-secondary" id="logout" >ë¡œê·¸ì•„ì›ƒ</button>
	</div>
</div>
</header>

 <nav class="navbar navbar-expand-lg navbar-dark bg-dark" aria-label="Tenth navbar example">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample08" aria-controls="navbarsExample08" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-md-center" id="navbarsExample08">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="main.html">í™ˆ</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="workList.html">ìš´ë™ëª©ë¡</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="calendar.html">ìš´ë™ì¼ì •</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="bbsList.html">ììœ ê²Œì‹œíŒ</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <br><br><br>
<div class="contentCenterPosition">
	<div id="mainFrame">
		<!-- ì œëª© -->
		<table class="table">
		  <thead>
		    <tr>
		      <th scope="col">ì œëª© :   <input type="text" id="title" readonly="readonly" size="20" style="width:50%;  border: 0; background-color: #f5f5f5;">     </th>
		    </tr>
		  </thead>
		  
		  <tbody>
		    <tr>
		      <th scope="row"><input type="text" id="nickname" readonly="readonly" size="20%" style="width:100%;  border: 0; background-color: #f5f5f5;">    </th>
		      <td><input type="text" id="wdate" readonly="readonly" size="30%" style="width:100%;  border: 0; background-color: #f5f5f5;"></td>
		      <td><div class="infoHorizontal" style="width:100%" id="likeAndCount"></div>	</td>
		    </tr>
		  </tbody>
		</table>
  
		<!-- ë‚´ìš© -->
		<div id="contentFrame" align="center">
			<div id="imgPosition">
				<div id="slideShow">
					<ul class="slides">
					
					</ul>
					
					<p class="controller">
						<!-- &lang: ì™¼ìª½ ë°©í–¥ í™”ì‚´í‘œ &rang: ì˜¤ë¥¸ìª½ ë°©í–¥ í™”ì‚´í‘œ -->
						<span class="prev">&lang;</span>
						<span class="next">&rang;</span>
					</p>
				</div>				
			</div>
			<div id="contentBox">
				<textarea id="content" readonly="readonly" rows="25" style="resize: none; padding:15px; line-height: 150%"></textarea>
		<br><br>
				<div id="btnBox">
					<div style="margin-left:0.6%">
						<button type="button" class="btn bigbtn btn-secondary" id="goToListBtn" style="color:#fff; background-color: #333;">ëª©ë¡ìœ¼ë¡œ</button>
					<!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
						<button type="button" class="btn bigbtn btn-secondary" id="bbsLikeBtn" style="color:#fff; background-color: #333;">ì¢‹ì•„ìš”ë²„íŠ¼</button>
					</div>
					<div align="right" style="width:25%; margin-right:0.8%;">
						<button type="button" class="btn bigbtn btn-secondary" id="updateBtn" style="color:#fff; background-color: #333;">ìˆ˜ì •</button>
						<button type="button" class="btn bigbtn btn-secondary" id="deleteBtn" style="color:#fff; background-color: #333;">ì‚­ì œ</button>
					</div>
				</div>
			</div>
		</div>
		
		<!-- ëŒ“ê¸€ -->
		<div>
			<div style="margin: 10px 2%; font-size:25px;" >
				ëŒ“ê¸€
			</div>
			<hr style="width:95.5%; margin-left: 2%; " align="center";>
			<!-- ëŒ“ê¸€ ëª©ë¡ -->
			<div id=replyFrame>
				<div class="replyList">
				
				</div>
			</div>
			<!-- ëŒ“ê¸€ì‘ì„± -->
			<div id="writeReplyFrame">
				<div style="margin: 0 1% ">
					<textarea id="replyWrite" onkeydown="resize(this)" onkeyup="resize(this)" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." rows="2" style="resize: none; padding:15px;"></textarea>
				</div>
				<br>
				<div id=replyBtnFrame>
					<div id="replybtnBox" style="margin-right:2%">
						<button type="button" class="btn bigbtn btn-secondary" id="writeReplyBtn"  style="color:#fff; background-color: #333;" >ë“±ë¡</button>
					</div>
				</div>
			</div>
		</div>
		
	</div>
</div>

<img alt="ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨" src="">

<div class="container">
  <footer class="py-3 my-4">
    <ul class="nav justify-content-center border-bottom">
    </ul>
    <p class="text-center text-muted">&copy; ë©€í‹°ìº í¼ìŠ¤ 6ì¡°</p>
  </footer>
</div>

<script type="text/javascript">
//sessionStorageì—ì„œ ê°€ì ¸ì˜¨ ë¡œê·¸ì¸ ì •ë³´
let str = sessionStorage.getItem("login");
// ê°€ì ¸ì˜¨ ë¡œê·¸ì¸ì •ë³´ë¥¼ jsoní˜•íƒœë¡œ ë³€í™˜
let userInfo = JSON.parse(str);
// ë„˜ê²¨ë°›ì€ seqë²ˆí˜¸ ë³€ìˆ˜ì— ì €ì¥
const url = new URL(location.href);
const urlParams = url.searchParams;
let seq = urlParams.get("seq");

//ë¡œê·¸ì•„ì›ƒê¸°ëŠ¥
$(document).ready(function(){
	
	let str = sessionStorage.getItem("login"); // ì„¸ì…˜ì €ì¥ì†Œì—ì„œ ê°’ ë¹¼ì˜´
	let json = JSON.parse(str); // ë¬¸ìì—´ì„ JSONìœ¼ë¡œ íŒŒì‹±
	let lstr = localStorage.getItem("login"); // ìë™ë¡œê·¸ì¸í–ˆë‹¤ë©´
	let ljson = JSON.parse(lstr); 

	if(str != null){
	$("#userNickname").html(json.nickname+"ë‹˜ì´ ì ‘ì†ì¤‘ì…ë‹ˆë‹¤.");
	}else{
	$("#userNickname").html(ljson.nickname+"ë‹˜ì´ ì ‘ì†ì¤‘ì…ë‹ˆë‹¤.");
	}

	$("#logout").click(function(){
		
		if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?") == true){
			const userAuth = json.auth;
			switch(userAuth){
			case 4:
				Kakao.init('33dac5c74d9c68aa75bc31a1474ec6cd');
				
				if(Kakao.Auth.getAccessToken()){
					Kakao.API.request({
						url:'/v1/user/unlink',
						success:(res)=>{
							console.log(res)
						},
						fail:(err)=>{
							console.log(err)
						},
					})
					Kakao.Auth.setAccessToken(undefined)
				}
			break
			case 5:
				let firebaseConfig = {
				    apiKey: "AIzaSyBf-7zB4MCZOc-48Xsxt2cyOTCRDfI80aw",
				    authDomain: "healthapp-client.firebaseapp.com",
				    projectId: "healthapp-client",
				    storageBucket: "healthapp-client.appspot.com",
				    messagingSenderId: "1011601613020",
				    appId: "1:1011601613020:web:2a87e02a1e4b21e2d0d419",
				    measurementId: "G-T99K3V7HCQ"
				  };

				// Initialize Firebase
				firebase.initializeApp(firebaseConfig);
				firebase.auth().signOut().then(()=>{
					console.log("êµ¬ê¸€ ë¡œê·¸ì•„ì›ƒ ì„±ê³µ")
				}).catch((err)=>{
					console.log("êµ¬ê¸€ ë¡œê·¸ì•„ì›ƒ ì—ëŸ¬")
				})
			}
				alert("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.")
				sessionStorage.clear();
				localStorage.clear();
				location.href="login.html";
		}
	});
});

// ëª©ë¡ìœ¼ë¡œ ë²„íŠ¼ í´ë¦­
$("#goToListBtn").click(function(){
	location.href = "bbsList.html";
});

// ìˆ˜ì •ë²„íŠ¼ í´ë¦­
$("#updateBtn").click(function(){
	location.href = 'bbsUpdate.html?seq=' + seq;
});

//ì‚­ì œë²„íŠ¼ í´ë¦­
$("#deleteBtn").click(function(){
	$.ajax({
		url:"http://localhost:3000/deleteBbs",
		type: "post",
		data: {"seq": seq},
		success: function(msg){
			if(msg == "success"){
				alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
				location.href = "bbsList.html";
			}else{
				alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\në‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”');
			}
		},
		error: function(){
			alert('error');
		}
	});
});

// ëŒ“ê¸€ ì‘ì„±í•˜ê¸° ë²„íŠ¼ í´ë¦­
$("#writeReplyBtn").click(function(){
	if($("#replyWrite").val().trim() == ""){
		alert('ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.');
	}else{
		if(confirm("ëŒ“ê¸€ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?") == true){
			// í™•ì¸ ëˆ„ë¥¼ì‹œ ì´ë²¤íŠ¸
			writeReply();
		}else{
			return;
		}
	}
	
});

// ì¢‹ì•„ìš” ë²„íŠ¼
$("#bbsLikeBtn").click(function(){
	$.ajax({
		url: "http://localhost:3000/likeCount",
		type: "post",
		data: {
			"bbs_no": seq,
			"user_id": userInfo.id
		},
		success: function(msg){
			if(msg == "count"){
				alert('ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤!');
				getBbs();
				
			}else{ // msg == notCount ì¼ë•Œ
				likeCancel();
			}
			
		},
		error: function(){
			alert('error');
		}
	});
});


// ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ ê´€ë ¨ ë³€ìˆ˜ì§€ì •
let slides; //ì „ì²´ ìŠ¬ë¼ì´ë“œ ì»¨í…Œì´ë„ˆ 
let slideImg; //ëª¨ë“  ìŠ¬ë¼ì´ë“œë“¤  
let slideCount; // ìŠ¬ë¼ì´ë“œ ê°œìˆ˜ 


let currentIdx = 0; //í˜„ì¬ ìŠ¬ë¼ì´ë“œ index

// í˜ì´ì§€ê°€ ì‹œì‘ë ë•Œ ì™„ë£Œë  ë¶€ë¶„
$(document).ready(function(){
	// ì„ íƒí•œ ê²Œì‹œê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
	getBbs();
	
	// í•´ë‹¹ ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°
	getReplyList();	
});

// textareaë†’ì´ ìë™ì¡°ì ˆ
var txtArea = $("#content");
if (txtArea) {
    txtArea.each(function(){
        $(this).height(this.scrollHeight);
    });
}

// ëŒ“ê¸€ì…ë ¥ë€(textarea) í¬ê¸° ìë™ì¡°ì ˆ
function resize(obj) {
	obj.style.height = '1px';
	obj.style.height = (12 + obj.scrollHeight) + 'px';
    
}

// ê²Œì‹œê¸€ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
function getBbs() {
	$.ajax({
		url:"http://localhost:3000/bbsDetail",
		type:"post",
		data:{
			"bbs_seq": seq,
			"user_id": userInfo.id
		},
		success: function(bbs){
			// ì œëª©
			$("#title").val(bbs.title);
			// ì‘ì„±ì
			$("#nickname").val(bbs.nickname);
			// ì‘ì„±ì¼
			var dateArr = bbs.wdate.split(":")	// :ë‹¨ìœ„ë¡œ ë‚˜ëˆ ì„œ ë°°ì—´ë¡œ ì €ì¥
			const wdate= dateArr[0] + ":" + dateArr[1]	// ë³€ìˆ˜ì— ì›í•˜ëŠ” í‘œê¸°ë°©ë²•ìœ¼ë¡œ ì €ì¥
			$("#wdate").val(wdate);
			// ì¢‹ì•„ìš” ë° ì¡°íšŒìˆ˜
			$("#likeAndCount").text("ğŸ‘ " + bbs.bbsLike + " / ğŸ‘€ "+ bbs.readcount);
			if(bbs.bbsImage == null){
				//$("#imgPosition").hide();
				//$("#imgPosition").empty();
				document.querySelector("#imgPosition").style.display="none";
			}
			// urlì„ í†µí•œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
			if(bbs.bbsImage != null){
				var imgArr = bbs.bbsImage.split(",");
				var urlFront = "https://firebasestorage.googleapis.com/v0/b/healthapp-client.appspot.com/o/images%2F";
				var urlBack = "?alt=media&token=df6804c5-5a28-44a9-a6b4-0a9e8df1589e";
				$.each(imgArr, function(i, item){
					let choiceImgArr = item.split("/");
					let imgName = choiceImgArr[1];
					
					let str = '<li><img src="' + (urlFront + imgName + urlBack) + '" width="300px" height="300px" alt="" style="float:left;"></li>'
									
					$(".slides").append(str);
				});
				
				slides = document.querySelector('.slides'); //ì „ì²´ ìŠ¬ë¼ì´ë“œ ì»¨í…Œì´ë„ˆ 
				slideImg = document.querySelectorAll('.slides li'); //ëª¨ë“  ìŠ¬ë¼ì´ë“œë“¤  
				slideCount = slideImg.length; // ìŠ¬ë¼ì´ë“œ ê°œìˆ˜ 
				//ì „ì²´ ìŠ¬ë¼ì´ë“œ ì»¨í…Œì´ë„ˆ ë„“ì´ ì„¤ì •
				slides.style.width = (slideWidth + slideMargin) * slideCount + 'px'; 
			}
			
			$("#content").text(bbs.content);
			if(userInfo.id != bbs.id && userInfo.auth != 1){
				$("#updateBtn").hide();
				$("#deleteBtn").hide();
			}
		},
		error: function(){
			alert('error');
		}
	});
}

// í•´ë‹¹ ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°
function getReplyList(){
	$.ajax({
		url:"http://localhost:3000/getReplyList",
		type: "post",
		data: {"seq": seq},
		success: function(list){
			$(".replyList").html("");
			
			$.each(list, function (i, item) {
				let str = '<div class="replywriter">' +
								'<div class="replynickname">' + item.nickname + '</div>'
				if(userInfo.id == item.id){
					str += 		'<div class="deleteReply" onclick="deleteReply(' + item.seq + ')"' + '>ì‚­ì œí•˜ê¸°</div>'
				}
				str += 		'</div>' +
							'<div class="replyContent">' +
								item.content + 
							'</div>'
				$(".replyList").append(str);
								
			});
		},
		error: function(){
			alert('error');
		}
	});
}

// ëŒ“ê¸€ ë“±ë¡í•˜ê¸°
function writeReply(){
	$.ajax({
		url: "http://localhost:3000/writeReply",
		type: "post",
		data: {
			"replyNum": seq,
			"id": userInfo.id,
			"nickname": userInfo.nickname,
			"title": "title",
			"content": $("#replyWrite").val(),
			"replyImage": null
		},
		success: function(msg){
			if(msg == "success"){
				alert("ëŒ“ê¸€ì„ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
			}else{
				alert("ëŒ“ê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œì‹œë„í•´ì£¼ì„¸ìš”.")
			}
			$("#replyWrite").val("");
			getReplyList();
		},
		error: function(){
			alert('error');
		}
	});
}

// í•´ë‹¹ ëŒ“ê¸€ ì‚­ì œí•˜ê¸°
function deleteReply(seq){
	if(confirm("ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ê¸€ì€ ë³µêµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.") == true){
		// í™•ì¸ ëˆ„ë¥¼ì‹œ ì´ë²¤íŠ¸
		$.ajax({
			url: "http://localhost:3000/deleteReply",
			type: "post",
			data: {"seq": seq},
			success: function(msg){
				if(msg == "success"){
					alert('ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
					getReplyList();
				}else{
					alert('ëŒ“ê¸€ì‚­ì œ ì‹¤íŒ¨. ë‹¤ì‹œì‹œë„í•´ì£¼ì‹­ì‹œì˜¤.');
				}
			},
			error: function(){
				alert('error');
			}
		});
	}else{
		// ì·¨ì†Œ ëˆ„ë¥¼ì‹œ ì´ë²¤íŠ¸
		return;
	}
}

// ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ ì‘ë™ í•¨ìˆ˜ ë° ì´ë²¤íŠ¸
const prev = document.querySelector('.prev'); //ì´ì „ ë²„íŠ¼ 
const next = document.querySelector('.next'); //ë‹¤ìŒ ë²„íŠ¼ 
const slideWidth = 500; //í•œê°œì˜ ìŠ¬ë¼ì´ë“œ ë„“ì´ 
const slideMargin = 360; //ìŠ¬ë¼ì´ë“œê°„ì˜ margin ê°’ 
 
function moveSlide(num) { 
	slides.style.left = -num * 400 + 'px'; 
	currentIdx = num; 
} 

prev.addEventListener('click', function () { 
	//ì²« ë²ˆì§¸ ìŠ¬ë¼ì´ë“œë¡œ í‘œì‹œ ëì„ë•ŒëŠ” ì´ì „ ë²„íŠ¼ ëˆŒëŸ¬ë„ ì•„ë¬´ëŸ° ë°˜ì‘ ì—†ê²Œ í•˜ê¸° ìœ„í•´ 
	//currentIdx !==0ì¼ë•Œë§Œ moveSlide í•¨ìˆ˜ ë¶ˆëŸ¬ì˜´  
	if (currentIdx !== 0) moveSlide(currentIdx - 1); 
}); 

next.addEventListener('click', function () { 
	// ë§ˆì§€ë§‰ ìŠ¬ë¼ì´ë“œë¡œ í‘œì‹œ ëì„ë•ŒëŠ” ë‹¤ìŒ ë²„íŠ¼ ëˆŒëŸ¬ë„ ì•„ë¬´ëŸ° ë°˜ì‘ ì—†ê²Œ í•˜ê¸° ìœ„í•´ 
	//currentIdx !==slideCount - 1 ì¼ë•Œë§Œ moveSlide í•¨ìˆ˜ ë¶ˆëŸ¬ì˜´ 
	if (currentIdx !== slideCount - 1) { moveSlide(currentIdx + 1); } 
});

// ì¢‹ì•„ìš” ì·¨ì†Œê¸°ëŠ¥ í•¨ìˆ˜
function likeCancel(){
	$.ajax({
		url: "http://localhost:3000/likeCountCancel",
		type: "post",
		data: {
			"bbs_no": seq,
			"user_id": userInfo.id
		},
		success: function(msg){
			if(msg == "complete"){
				alert('ì¢‹ì•„ìš”ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
				getBbs();
			}else{
				alert('ì¢‹ì•„ìš” ì·¨ì†Œ ì‹¤íŒ¨.\në‹¤ì‹œì‹œë„í•´ì£¼ì„¸ìš”.');
			}
		},
		error: function(){
			alert('error');
		}
	});
}
 

</script>
</body>
</html>